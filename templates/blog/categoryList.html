{% extends 'base-blog.html' %}

{% block title %}ÊñáÁ´†ÂàóË°®{% endblock %}

{% block content %}
    <!--‰∏≠Èó¥‰∏ª‰ΩìÈÉ®ÂàÜ-->
    <main class="page-main  clearfix">
        <div class="layui-row">
            <!--        &lt;!&ndash;    È°µÈù¢Â∑¶‰æßÁïôÁ©∫&ndash;&gt;-->
            <!--        <div class="layui-hide-xs layui-col-sm1 layui-col-md2 left-null">-->
        </div>
        <!--    È°µÈù¢‰∏ª‰ΩìÈÉ®ÂàÜ-->
        <div class="layui-col-md-offset2 layui-col-sm12 layui-col-md8 page-main-centre">
            <div class="layui-row main-centre">
                <!--            ‰∏ª‰ΩìÂ∑¶‰æßÈÉ®ÂàÜ-->
                <div class="layui-col-md9 main-left">
                    <!--                    ‰ΩçÁΩÆ‰ø°ÊÅØ-->
                    <blockquote class="layui-elem-quote location suspend">
                        <p>ÊÇ®ÁöÑ‰ΩçÁΩÆÔºö <a href="/">È¶ñÈ°µ</a>
                            <i class="layui-icon layui-icon-next"></i>
                            <span>ÊñáÁ´†ÂàÜÁ±ª</span>
                            <i class="layui-icon layui-icon-next"></i>
                            <span>{{ category_name }}</span>
                        </p>
                    </blockquote>
                    <!--            ÊñáÁ´†ÂàóË°®-->
                    <div class="index-new">
                        <h4 id="list-title">
                            <strong>
                                <span>üìú ÊñáÁ´†ÂàóË°®</span>
                            </strong>
                        </h4>
                        {% for article in articles_list %}
                            <div class="layui-row layui-col-space20 article-box">
                                <div class="layui-col-xs12 layui-col-md4">
                                    <div class="img-cover img-zoom">
                                        <a href="/blog/show-{{ article.id }}" title="{{ article.title }}">
                                            <img lay-src="media/{{ article.img }}" width="100%">
                                        </a>
                                    </div>
                                </div>
                                <div class="layui-col-xs12 layui-col-md8">
                                    <h3>
                                        <a href="/blog/show-{{ article.id }}">{{ article.title }}</a>
                                    </h3>
                                    <p class="txt-cont hidden-xs">
                                        <a href="/blog/show-{{ article.id }}">{{ article.excerpt }}</a>
                                    </p>
                                    <div class="list-article-info">
                                        <a href="/blog/category-{{ article.category_id }}"
                                           class="label-tag tag-color-{{ article.category.id }}">{{ article.category }}</a>
                                        <span>
                                                <i class="fas fa-clock">
                                                    <span class="timeago"
                                                          datetime="{{ article.created_time | date:"Y-m-d H:i" }}"></span>
                                                </i>
                                            </span>
                                        <span>
                                                <i class="fas fa-eye">{{ article.view }}</i>
                                            </span>
                                        <span>
                                                <i class="fas fa-thumbs-up">{{ article.like }}</i>
                                            </span>
                                        <span>
                                                <i class="fas fa-heart">{{ article.collection }}</i>
                                            </span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                        <div id="paging"></div>
                    </div>
                </div>
                {% include 'blog/aside.html' %}
                <!--            ‰∏ª‰ΩìÂè≥‰æßÈÉ®ÂàÜ-->
            </div>
        </div>
        </div>
    </main>
{% endblock %}

{% block js %}
    <script>

        layui.use(['laypage', 'layer','flow'], function () {
            var laypage = layui.laypage
                , layer = layui.layer
                , flow = layui.flow;

            // ÂàÜÈ°µ
            laypage.render({
                elem: 'paging'
                , count: {{ count }}
                , limit: 5
                , limits: [5, 10, 15, 20]
                , layout: ['prev', 'page', 'next', 'limit', 'limits',]
                , jump: function (obj, first) {
                    if (first) {
                        // Ëé∑ÂèñÁ¨¨‰∏ÄÈ°µÂÜÖÂÆπ
                        $.ajax({
                            type: "GET",
                            url: "{% url 'blog:categoryPage' %}",
                            data: {
                                category_id: {{ category_id }},
                                limit: obj.limit,
                                page: 1
                            },
                            success: function (result) {
                                if (result.code == 1) {
                                    $(".article-box").remove();
                                    createEle(result);
                                } else {
                                    layer.alert(result.msg, {icon: 2});
                                }
                            },
                            error: function (xhr) {
                                alert(xhr.text());
                            }
                        })
                    } else {
                        //Êç¢È°µÊâßË°å
                        $.ajax({
                            type: "GET",
                            url: "{% url 'blog:categoryPage' %}",
                            data: {
                                category_id: {{ category_id }},
                                limit: obj.limit,
                                page: obj.curr
                            },
                            success: function (result) {
                                if (result.code == 1) {
                                    $(".article-box").remove();
                                    createEle(result);
                                } else {
                                    layer.alert(result.msg, {icon: 2});
                                }
                            },
                            error: function (xhr) {
                                alert(xhr.text());
                            }
                        })
                    }
                }
            });
        });

        // Ê†πÊçÆajaxËøîÂõûÂàÜÈ°µÁªìÊûúÂàõÂª∫ÂÜÖÂÆπ
        function createEle(result) {
            layui.each(result.data, function (index, item) {
                var $article = $("<div class=\"layui-row layui-col-space20 article-box\">\n" +
                    "    <div class=\"layui-col-xs12 layui-col-md4\">\n" +
                    "        <div class=\"img-cover img-zoom\">\n" +
                    "            <a href=\"/blog/show-" + item.id + "\" title=\"djangoÊµãËØïÈ°µ1\">\n" +
                    "                <img width=\"100%\" lay-src=\"media/" + item.img + "\">\n" +
                    "            </a>\n" +
                    "        </div>\n" +
                    "    </div>\n" +
                    "    <div class=\"layui-col-xs12 layui-col-md8\">\n" +
                    "        <h3>\n" +
                    "            <a href=\"/blog/show-" + item.id + "\">" + item.title + "</a>\n" +
                    "        </h3>\n" +
                    "        <p class=\"txt-cont hidden-xs\">\n" +
                    "            <a href=\"/blog/show-" + item.id + "\">" + item.excerpt + "</a>\n" +
                    "        </p>\n" +
                    "        <div class=\"list-article-info\">\n" +
                    "            <a href=\"/blog/category-" + item.category_id + "\" class=\"label-tag tag-color-" + item.category_id + "\">" + item.category + "</a>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-clock\">\n" +
                    "                       <span class=\"timeago\" datetime=\"" + item.created_time + "\"'></span>" +
                    "                    </i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-eye\">" + item.view + "</i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-thumbs-up\">" + item.like + "</i>\n" +
                    "                </span>\n" +
                    "            <span>\n" +
                    "                    <i class=\"fas fa-heart\">" + item.collection + "</i>\n" +
                    "                </span>\n" +
                    "        </div>\n" +
                    "    </div>\n" +
                    "</div>")
                $("#list-title").after($article);
                // Êó∂Èó¥ÊòæÁ§∫Âá†Â§©Ââç
                var timeago = layui.timeago;
                timeago.render($('.timeago'));
                // ÂõæÁâáÊáíÂä†ËΩΩ
                var flow = layui.flow;
                flow.lazyimg();
            });
        }

        // ÂØºËà™Ê†èÂΩìÂâçÊ†áÁ≠æÈ°µ
        $(".nav2").addClass("layui-this");
        var category_id = "#category-" + {{ category_name.id}}
            $(category_id).addClass("layui-this")
        var m_category_id = "#m-category-" + {{ category_name.id}}
            $(m_category_id).addClass("layui-this")
        $(m_category_id).parents("li").addClass("layui-nav-itemed")
    </script>
{% endblock %}